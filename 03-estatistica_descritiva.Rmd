---
output: html_document
editor_options: 
  chunk_output_type: inline
---
# Estatística Descritiva

```{r base pesquisa_espanha e pacotes, include = FALSE }

load("~/anovabr/mqt/bases/Base R - Pesquisa mapfre.RData") #base

library(tidyverse)
library(pander)
library(knitr) #tables and graphs
library(kableExtra) #tables with different styles

library(DiagrammeR) #flowcharts
library(gridExtra) #plot together
library(janitor) #descritipve stats

```


```{block, type="objectives"}
**Objetivos do capítulo**  
1. Apresentar tabelas e gráficos  
2. Introduzir os verbos do dplyr e funções do ggplot.  
3. Oferecer heurísticas ou regras gerais para criação de gráficos
```

A Estatística descritiva visa <mark>descrever, resumir e apresentar</mark> os dados obtidos em uma pesquisa de maneira a tornar os resultados mais fáceis de serem compreendedidos. É possível fazer isso de maneira <u>textual</u>, <u>tabular</u> e <u>gráfica</u>. Cada uma dessa formas apresenta vantagens e desvantagens. Tabelas e texxtos permitem agrupar e detalhar bem os resultados e, com isso, torná-los mais precisos e abrangentes. Entretanto, esse detalhamento pode também dificultar um pouco no entendimento geral dos resultados. Por sua vez, gráficos geram sumários descritivos em que se é possível ter um entendimento rápido dos resultados. Além disso, os gráficos podem incorporar outros elementos que oferecem um primeiro entendimento inferencial, tal como barras de erro e intervalos de confiança.  

Em todas estas técnicas, mas especialmente no desenvolvimento de gráficos, deve-se evitar gerar distorções na interpretação dos resultados. 



## Pesquisa
  
<div class="alert alert-info" role="alert">
  <strong>Base:</strong> Base R - Pesquisa mapfre.RData
</div>  

Neste capítulo, vamos utilizar a pesquisa intitulada ["Depression and Anxiety Symptoms in a Representative Sample of Undergraduate Students in Spain, Portugal, and Brazil"](https://doi.org/10.1590/0102.3772e36412 ). Nessa pesquisa, sou o coautor e o pesquisador responsável para correspondência. O objetivo deste estudo foi desenvolver um mapa epidemiológico de sintomas de ansiedade e depressão em universitários em três países, bem como investigar possíveis relações entre tais condições de saúde e fatores sociodemográficos. Para acessar eventuais transtornos depressivos, o Inventário Beck de Depressão (BDI) foi utilizado e para acessar condições de ansiedade, o Inventário Beck de Ansiedade (BAI) foi utilizado.  

Um diferencial importante do trabalho foi a seleção amostral. Partiu-se de uma amostra estratificada (probabilística) dos estudantes de três universidades, PUC-Rio (Brasil), Universidade de Extremadura (Espanha) e Universidade de Coimbra (Portugal). Isso permitiu ter maior validade externa dos resultados.


## Execução no R 

### Tabelas   

Tabelas apresentam os sumários informativos de uma pesquisa de maneira reunida e objetiva. É possível utilizá-las com apenas uma ou com múltiplas variáveis, sejam elas categóricas ou contínuas. As tabelas precisam ter um título, bem como colunas e linhas. Com frequência, as instrução para desenvolvimento de tabelas variam de editora para editora e, segundo a APA, apenas as linhas superiores e inferiores recebem bordas e números decimais são arredondados até a segunda casa decimal.  

Frequentemente, Uma primeira tabela informativa deve apresentar a quantidade de participantes amostrados. Neses caso, como três países fizeram parte da pesquisa, os dados serão agrupados por eles. O desenvolvimento desta tabela pode ser feito com pacote `janitor`, tal como demonstrado a seguir.

```{r}
Dataset %>% 
  tabyl(country) %>% 
  adorn_totals() %>% 
  pander()

```

A adição de um um outro agrupador relacionado ao sexo é também importante. Note que existem casos ausentes na variável <u>sexo</u>. Isso ocorre com bastante frequência e há diferentes estratégias para lidar com isso, que serão discutidas em momento oportuno. Para que tais condições não sejam apresentadas, a função `filter` será implementada.   

```{r}
Dataset %>% 
  filter(!is.na(sex)) %>% 
  tabyl(sex, country) %>% 
  adorn_totals() %>% 
  pander()
```

Para apresentar a quantidade de participantes totais, bem como a quantidade e a porcentagem de homens e mulheres por país, a codificação torna-se um pouco mais densa. A tabela a seguir reproduz parcialmente a tabela 1 do artigo publicado.  

```{r}
Dataset %>%
  filter(!is.na(sex)) %>% 
  tabyl(country, sex) %>%
  adorn_totals(c("row", "col")) %>%
  adorn_percentages("row") %>% 
  adorn_pct_formatting(rounding = "half up", digits = 0) %>%
  adorn_ns() %>%
  pander()
```
Enquanto as tabelas com variáveis categóricas apresentam valores absolutos e suas respectivas porcentagens, tabelas para variáveis contínuas costumam utilizar medidas de posição e dispersão. A média e a mediana são os sumários mais utilizados para indicar a posição ou a concentração dos dados. Por sua vez, o desvio-padrão e a amplitude ou intervalo interquartil são utilizados para indicar o afastamento dos dados dessas medidas de posição. O R oferece muitos pacotes especializados em tabelas descritivas, cada qual com características positivas e limitadoras. 


De maneira análoga à construção da primeira tabela deste capítuo, os valores do BDI e do BAI serão apresentados em função do país do participante.

```{r}
Dataset %>%
  group_by(country) %>% 
  summarise_at(vars(bdi_sum, bai_sum), lst(n=~n(),media=mean, DP=sd), na.rm=T) %>% 
  mutate_if(is.numeric, round,2) %>% 
  t() %>% 
  pander(., split.table = Inf)
```

É também possível reunir tais resultados a partir do sexo do participante.


```{r}
Dataset %>%
  filter(!is.na(sex)) %>% 
  group_by(sex) %>% 
  summarise_at(vars(bdi_sum, bai_sum), lst(n=~n(),media=mean, DP=sd), na.rm=T) %>% 
  mutate_if(is.numeric, round,2) %>% 
  t() %>% 
  pander(., split.table = Inf)
```
A apresentação agrupando pelo país e sexo do participante encontra-se abaixo:  

```{r}
Dataset %>%
  filter(!is.na(sex)) %>% 
  group_by(country,sex) %>% 
  summarise_at(vars(bdi_sum, bai_sum), lst(n=~n(),media=mean, DP=sd), na.rm=T) %>% 
  mutate_if(is.numeric, round,2) %>% 
  t() %>% 
  pander(., split.table = Inf)
```


### Gráficos

A máquina gráfica do tidyverse é o ggplot. Para executar um gráfico, <mark>pelo menos</mark> 3 argumentos são necessários para criação de gráficos, que são:

1. O banco dados `(data = )`,      
2. O aspecto estético, que permite diferentes complementos `aes(x = , y = , fill = , color = )`,  
3. O aspecto geométrico, que varia em função do gráfico a ser apresentado `geom_ ` 

É também possível adicionar outros argumentos, como:  

4. Transformações estatísticas `stat_summary`  
5. Facetas para dividir a visualização `facet_`  
6. Sistema de coordenadas `coord_`  
7. Temas específicos `theme_ `  

É importante notar que apesar dos argumentos utilizados na sintaxe serem similares aos utilizados em toda família tidyverse, a ligação `%>%` é substituída pelo `+`. 

Quando bem feitos, os gráficos são extremamente úteis. Como aponta Morettin e Bussab [-@morettin_bussab_2010], eles possibilitam:   

(a) buscar padrões e relações;     
(b) confirmar (ou não) certas expectativas que se tinha sobre os dados;   
(c) descobrir novos fenômenos;  
(d) confirmar (ou não) suposições feitas sobre os procedimentos estatísticos usados; e  
(e) apresentar resultados de modo mais rápido e fácil.  

É sempre bom que o gráfico tenha um título e uma escala. A maioria dos gráficos são apresentados em um plano com um eixo horizontal (abcissas) e um vertical (ordenadas). Quando há apenas uma variável para apresentar, o eixo x irá reunir seus níveis e o eixo y as contagens ou proporções e densidade. Quando há duas variáveis, o eixo x irá apresentar os níveis da variável indepenente, enquanto o y apresentará os valores médios encontrados. Quando há mais de uma variável independente, um agrupador ou cluster deverá ser computado. Com frequência, o eixo x recebe a variável independente com mais níveis, enquanto o agrupador recebe as outras.   

Existem diferentes heurísticas que auxiliam na escolha do melhor gráfico a ser desenvolvido para apresentar os resultados de uma pesquisa. Uma delas parte do pressuposto que, quando há duas ou mais variáveis, a VD é continua e solicita que duas perguntas sejam respondidas, que são:  

1. <mark>Quantas</mark> variáveis serão apresentadas ?  
2. Qual o <mark>nível de medida da variával independente </mark>?  

Com isso, o diagrama abaixo oferece uma árvore de decisão funcional.

```{r, echo=FALSE}
grViz("digraph flowchart {
      # node definitions with substituted label text
      
      node [
      fontname = Helvetica,
      fillcolor = 'Orange', 
      shape = rectangle,
      style = filled]
      
      A[label = 'Quantas variáveis vão ser apresentadas?']
      B[label = 'Nivel de medida da VI']
      C[label = 'Nivel de medida da VI']
      

      node [fillcolor = 'white', style = filled]
      A -> 'Apenas 1';
      A -> '2 ou +';

      'Apenas 1' -> B -> { 'Discreta' 'Contínua' };
      '2 ou +' -> C -> { 'Discreta ' 'Contínua '};
       
       Discreta -> { Setor Barras }
       Contínua -> { Histograma Densidade Boxplot }
       
       
       'Discreta ' -> { 'Barras ' Colunas 'Boxplot ' }
       'Contínua ' -> { Linhas Dispersão }
       
       
     }")
```

Nota: Nessa apresentação, pragmaticamente as variáveis categóricas são tratadas como discretas.


### 1 variável discreta

Quando há apenas uma variável discreta (incluindo aqui as categóricas), os gráficos são criados para apresentar as contagens e/ou suas proporções. Nesse caso, é recomendado utilização de um <u>gráfico de barras</u> ou <u>gráfico de setor</u>. Apesar de ser possível apresentar as frequências absolutas, esses resultados podem gerar distorção da informação e, portanto, é preferível sempre apresentar as proporções de ocorrência de uma determinada variável ou valor. Por definição, quando se trabalha com proporções, o valor máximo da soma das proporções é 100.

O gráfico de barras abaixo apresenta a contagem absoluta dos participantes pesquisados em cada país.

```{r}
ggplot(Dataset, aes(x = country)) +
  geom_bar() +
  labs(x = "País", title = "Número de participantes nos países investigados")
```

Apesar desse gráfico auxiliar em um primeiro entendimento dos dados, a mudança da contagem para proporções é indicada. Para fazer isso, um recurso do pacote `scales` foi implementado para adequar o eixo y e adicionar o valor textual às colunas.

```{r}
ggplot(Dataset, aes(x = country, y = ..prop.., group = 1)) + 
  geom_bar(stat = "count") +
  geom_text(aes(label=scales::percent(round(..prop..,2)), 
                y=..prop..), stat= "count", color = "white", size = 3, position = position_stack(vjust = 0.5)) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(x = "País", title = "Proporção de participantes em cada país investigado")
```

O gráfico de setor (as vezes chamado de polar, pizza ou torta) pode também ser utilizado. O aspecto principal desse gráfico é apresentar os setores de maneira proporcional às frequências.

```{r}
Dataset %>% 
  count(country) %>% 
  mutate(pct = n/sum(n)) %>% 
  ggplot(., aes(x="", y= pct, fill=country)) +
  geom_col() +
  geom_text(aes(label = scales::percent(round(pct,3))), position = position_stack(vjust = 0.5))+
  coord_polar(theta = "y") +
  labs(title = "Proporção de participantes em cada país")
```


### 1 variável contínua

Quando uma única variável deve ser apresentada e ela é continua, os melhor gráficos são o histograma, densidade (kernel) e o boxplot.

Abaixo um histograma da idade dos participantes:

```{r}
ggplot(Dataset, aes(x = age)) +
  geom_histogram(bins = 30, color = "black", fill = "lightgrey") +
  labs(title = "Distribuição da idade dos participantes")
```

Abaixo um gráfico de densidade da idade:

```{r}
ggplot(Dataset, aes(x = age)) +
  geom_density(fill = "lightgray") +
  labs(title = "Distribuição da idade dos participantes")
```

Todas as distribuições tem uma localização, uma dispersão e um formato. De uma maneira mais direta, tanto o histograma como o gráfico de densidade conseguem informar bem, principalmente, sobre o <u>formato</u> da distribuição. Nesse caso, trata-se de uma assimetria positiva ou à direita. 


Por sua vez, abaixo o boxplot dessa mesma variável: 

```{r}
ggplot(Dataset, aes(y = age, x = "")) +
  geom_boxplot() +
  labs(title = "Distribuição da idade dos participantes")
```

O boxplot apresenta vantagens em comparação com os outros gráficos apresentados até agora. Além de apresentar o formato da distribuição, ele também (1) apresenta na área da caixa a concetração onde 50% dos dados estão, (2) a mediana dos resultados, na linha interna e mais espessa da caixa, (3) os valores mínimos e máximos e (4) os eventuais outliers. É importante notar que a parte inferior da caixa é formada pelo valor do primeiro quartil (Q1), a linha mais espessa interna apresenta o segundo quartil (Q2) ou a mediana e a parte superior da caixa apresenta o valor do terceiro quartil (Q3). Os bigodes são frequentemente construídos com base em `Q1 - 1.5*IQR` e `Q3 + 1.5*IQR` e valores acima ou abaixo dele são entendidos como anômalos ou outliers. Por definição, os outliers são sempre poucos, mesmo que isso possa ser um pouco contraintuitivo nesta apresentação de agora. 

O gráfico abaixo apresenta parte dos valores descritos.   

```{r}
ggplot(Dataset, aes(y = age, x = "")) +
  geom_boxplot()  +
  stat_summary(
    aes(label=sprintf("%1.1f", ..y..)),
    geom="text", 
    fun.y = function(y) boxplot.stats(y)$stats,
    position=position_nudge(x=0.5), 
    size=3.5)
```

Apesar de ser um pouco difícil de se visualizar ao início, a informação apresentada em um boxplot e no gráfico de densidade são virtualmente as mesmas, tal como demonstrado a seguir.   

```{r}
gridExtra::grid.arrange(
  #Grafico 1
  ggplot(Dataset, aes(x = age)) +
  geom_density(fill = "lightgray") + labs(x="", y=""),
  #Grafico 2
  ggplot(Dataset, aes(y = age, x = "")) +
  geom_boxplot() + labs(x = "") +
  coord_flip(),
  top = "Distribuição da idade dos participantes" #título
)
```


## 2 variáveis com VI discreta (e VD contínua)  

Gráficos de barras ou colunas e boxplots são adequados para apresentar essa relação. Basicamente, esses gráficos permitem verificar a <u>diferença</u> entre os grupos. 

Como exemplo, o gráfico abaixo mostra os resultados do Inventário Beck de Ansiedade entre 3 países investigados. 

```{r}
ggplot(Dataset, aes(x = country, y = bai_sum)) +
  geom_bar(stat = "summary", fun = mean) 
```

Tal como apresentado no início do capítulo, é possível adicionar outros elementos ao gráfico para que uma primeira apreensão inferencial seja possível. Nesse sentido, o gráfico abaixo apresenta também as barras de erro.


```{r}
ggplot(Dataset, aes(x = country, y = bai_sum)) +
  geom_bar(stat = "summary", fun = mean) +
  stat_summary(geom = "errorbar",fun.data = mean_se, width = .5) 
```

O boxplot a seguir também é um gráfico indicado. É importante notar que esse gráfico, a priori, <u>não</u> traz informações sobre a média, mas sim sobre a <u>distribuição</u> dos resultados. Evidentemente, como esse gráfico é bastante compreensivo, uma primeira noção inferencial já pode ser feita.   

```{r}
ggplot(Dataset, aes(x = country, y = bai_sum)) +
  geom_boxplot()
```


## 2 variáveis com VI contínua (e VD contínua)  

Assumindo que a VI é contínua e a VD também, o gráfico de pontos e de dispersão são virtualmente identicos e indicados. Esses gráficos permitem verificar a <u>associação</u> entre as variáveis. No ggoplot, o argumento `geom_point` (à esquerda) e `geom_jitter` (à direita) são possíveis. 

```{r}
gridExtra::grid.arrange(
  #Grafico 1
  ggplot(Dataset, aes(x = age, y = bai_sum)) +
  geom_point(),
  
  #Grafico 2
  ggplot(Dataset, aes(x = age, y = bai_sum)) +
  geom_jitter(),
  nrow=1
)


```


Tradicionalmente, de maneira análoga às barras de erros apresentadas em gráficos cujas VIs são discretas, adiciona-se uma reta de regressão amostral (FRA) quando a VI é contínua, tal como apresentado a seguir. É importante atentar que o capítulo sobre modelos de regressão irá trabalhar melhor este conceito.

```{r}
ggplot(Dataset, aes(x = age, y = bai_sum)) +
  geom_jitter() +
  geom_smooth(method = "lm")
```

## Outros gráficos e configurações

Evidentemente, é possível apresentar mais informações nos gráficos com mais de um variável apresentada, desde que elas sejam relacionadas ao problema de pesquisa estudado e não sobrecarreguem a visualização dos resultados. Frequentemente, as informações adicionais são feitas pela inclusão de <u>clusters</u> ou <u>agrupamentos</u>. Isso é tanto possível em gráficos cuja VI seja discreta quanto contínua.

No exemplo abaixo, o gráfico dos resultados do Inventário Beck de Ansiedade entre os 3 países investigados (VI discreta) agora está agrupado pelo sexo do participante.

```{r}
Dataset %>% 
  filter(!is.na(sex)) %>% 
  ggplot(., aes(x = country, y = bai_sum, fill = sex)) +
  geom_bar(stat = "summary", position = "dodge") +
  stat_summary(geom="errorbar", fun.data = mean_se, position = position_dodge(0.95), width = .5) 
```

Já no exemplo abaixo, a relação entre idade e pontuação no Inventário Beck de Ansiedade está agora agrupada pelo sexo do participante.

```{r}
Dataset %>% 
  filter(!is.na(sex)) %>% 
  ggplot(., aes(x = age, y = bai_sum, color = sex)) +
  geom_jitter() +
  geom_smooth(method = "lm") 
```

Em situações onde existe uma grande quantidade de informação para ser apresentada, os resultados começam a se tornar difíceis de serem entendidos. O gráfico abaixo, por exemplo, é excessivamente carregado de informação e, consequentemente, inadequado.

```{r}
Dataset %>% 
  filter(!is.na(sex)) %>% 
  ggplot(., aes(x = age, y = bai_sum, color = sex, shape = country)) +
  geom_jitter() +
  geom_smooth(method = "lm") 
```

Em outro sentido, o gráfico a seguir quebra a apresentação dos resultados por país e, com isso, potencializa que a informação seja melhor compreendida.

```{r}
Dataset %>% 
  filter(!is.na(sex)) %>% 
  ggplot(., aes(x = age, y = bai_sum, color = sex)) +
  geom_jitter() +
  geom_smooth(method = "lm") +
  facet_wrap( ~ country)
```


## Resumo  

Este capítulo apresentou os aspectos tabulares e gráficos corriqueiramente encontrados em pesquisas de Psicologia e áreas congêneres. Entre os pontos principais, a heurística típica de construção de gráficos é um conteúdo importante para ser sempre lembrado e tem as seguintes condições:

1. O gráfico deve ser sempre informativo e não oferecer distorções dos resultados
2. A quantidade e a natureza (escala ou nível de medida) das variáveis definem o gráfico a ser feito
3. Quando bem feitos, gráficos permitem um primeiro resultado inferencial
