---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Qui quadrado


```{r, include = FALSE }
load(file="~/anovabr/mqt/bases/Base R TDAH Arruda.RData")
library(tidyverse)
library(janitor)
library(knitr) #tables and graphs
library(kableExtra) #tables with different styles

library(descr) #chi squared
library(epitools) #epidemiology
```




```{block, type="objectives"}
**Objetivos do capítulo**  
1. Introduzir o Qui quadrado  
2. Realizar gráficos relacionados    
2. Apresentar os pressupostos do teste  
3. Apresentar e interpretar métricas de tamanho do efeito  
5. Dar exemplos relacionados à escrita dos resultados  
```


O Teste Qui-quadrado é um conjunto de, ao menos, três testes estatísticos desenvolvidos para análise de variáveis categóricas e que permitem testar a homogeneidade da distribuição de uma variável (Homogeneity), sua aderência (Goodness of fit) ou a indepedência entre duas variáveis. Como todos os testes não-paramétricos, ele é livre de uma distribuição de probabilidade característica e a mecânica matemática é similar entre esses três tipos de qui-quadrado:


$$\chi^2=\sum_{k=1}^{n} \frac{(O_k - E_k)^2}{E_k}$$




## Pesquisa
  
<div class="alert alert-info" role="alert">
  <strong>Base: </strong> Base R TDAH Arruda.Rdata
</div>  


Neste capítulo, vamos utilizar a pesquisa intitulada "Parent-reported diagnosis of Attention Deficit Hyperactivity Disorder and psychostimulant use among children and adolescents: a population-based nationwide study", que está em avaliação pela revista "Social Psychiatry and Psychiatric Epidemiology (SPPE)". Neste trabalho, tivemos o objetivo de verificar aspectos epidemiológicos do Transtorno do Déficit de Atenção com Hiperatividade (TDAH) em uma amostra representativa de crianças e adolescentes brasileiros, bem como explorar eventuais associações entre características sociodemográficas, especialmente os sexo do participante, e possíveis fatores e risco e TDAH.

## Execução no R

Como exposto no decorrer de outros capítulos, o teste de hipóteses começa pela formulação conceitual das hipóteses. Apesar de ser possível estipular $H_0$ e $H_a$ a partir de equações específicas,a apresentação será textual/substantiva.


$$H_0 = Não\ há\ associação\ entre\ sexo\ e\ TDAH \\ H_a = Há\ associação\ entre\ sexo\ e\ TDAH \\ \alpha = 0.05$$
Uma característica colateral a esta apresentação textual do teste de hipóteses do Qui-quadrado é evitar confusões que ocorrem em relação ao conceito do teste e sua formulação matemática. Com muita frequência, dividimos os testes de hipóteses naqueles que verificam "associação" e naqueles que verificam "diferenças". Conceitualmente, o Qui-quadrado investiga associação entre variáveis. No entanto, sua formulação matemática é feita pela diferença entre um valor observado e um valor esperado (tal como ilustrado na equação ao início do capítulo). ASsim, acredito que a formulação apenas textual evita criar confusões e ainda tornar o conteúdo mais palatável.

Posto isso, o gráfico de barras é sempre um bom início para visualizar os dados. Repare que a barra azul (que representa a porcentagem de TDAH) parece se comportar de maneira diferente nos grupos. 

```{r}
ggplot(ds_selected, aes(x= sex_male, fill = adhd_parent)) +
  geom_bar(position = "fill") +
  coord_flip() +
  theme_bw() +
  labs(x = "sexo", y = "Proporção", fill = "TDAH")
```




```{r}
ds_selected %>%
  tabyl(sex_male, adhd_parent) %>%
  adorn_totals(c("row", "col")) %>%
  adorn_percentages("row") %>% 
  adorn_pct_formatting(rounding = "half up", digits = 0) %>%
  adorn_ns() 
```


```{r}
ds_selected %>% #<-- dataset with predictors
  count(adhd_parent) %>% 
  mutate(prop = prop.table(n)) %>% 
   adorn_totals() %>% 
  kable(digits = 2) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```


Relação entre sexo (meninos e meninas) e apresentar TDAH (sim ou não)

```{r}
ds_selected %>% #Relative Risk for gender
  #drop_na() %>% 
  {CrossTable(.$sex_male,.$adhd_parent,
              expected = T,
              chisq = T)}
```


Risco

```{r}
#relative risk (boys)
riskratio(ds_selected$sex_male,ds_selected$adhd_parent) 
oddsratio(ds_selected$sex_male,ds_selected$adhd_parent, method =  "wald")
```

